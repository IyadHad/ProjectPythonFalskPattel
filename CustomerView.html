{% extends "layout.html" %}
{% block content %}
<body>
    <h1>Bank Accounts</h1>
    <div style="display: flex; justify-content: space-around;">
        <div>
            <h2>Current Account</h2>
            <p>Balance: {{ accounts.current }}€</p> 
            <ul>
               {% for transaction in accounts.transactions %}
                  <li>{{ transaction.2 }} {{ transaction.1 }} on {{ transaction.0 }}</li>
               {% endfor %}
            </ul>
            <form method="POST" action="{{ url_for('CustomerviewPage') }}">
                <input type="hidden" name="account_type" value="current">
                <label for="amount">Amount:</label>
                <input type="number" name="amount" required>
                <button type="submit" name="action" value="withdraw">Withdraw</button>
                <button type="submit" name="action" value="deposit">Deposit</button>
            </form>
        </div>
        <div>
            <h2>Savings Account</h2>
            <p>Balance: {{ accounts.savings }}€</p>
            <form method="POST" action="{{ url_for('CustomerviewPage') }}">
                <input type="hidden" name="account_type" value="savings">
                <label for="amount">Amount:</label>
                <input type="number" name="amount" required>
                <button type="submit" name="action" value="withdraw">Withdraw</button>
                <button type="submit" name="action" value="deposit">Deposit</button>
            </form>
        </div>
    </div>
    <h1>Transaction History</h1>
    <table border="1">
        <thead>
            <tr>
                <th>Account</th>
                <th>Action</th>
                <th>Amount</th>
            </tr>
        </thead>
        <tbody id="transactionTableBody">
            <!-- Les transactions seront ajoutées ici au fur et à mesure -->
        </tbody>
    </table>

    <script>
        function refreshTransactions() {
            // Effectuez une requête AJAX pour récupérer les transactions
            fetch('/get_transactions')
                .then(response => response.json())
                .then(transactions => {
                    const tableBody = document.getElementById('transactionTableBody');
                    tableBody.innerHTML = ''; // Efface le contenu actuel du tableau

                    // Ajoute les nouvelles transactions au tableau
                    transactions.forEach(transaction => {
                        const row = `<tr><td>${transaction.account}</td><td>${transaction.action}</td><td>${transaction.amount}</td></tr>`;
                        tableBody.innerHTML += row;
                    });
                })
                .catch(error => console.error('Error fetching transactions:', error));
        }

        // Rafraîchissez les transactions toutes les 5 secondes (ajustez selon vos besoins)
        setInterval(refreshTransactions, 5000);

        // Appelez refreshTransactions une fois au chargement de la page
        refreshTransactions();
    </script>
</body>
{%endblock%}